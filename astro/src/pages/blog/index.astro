---
import { getCollection } from 'astro:content';
import BlogIndex from '@/components/blog/BlogIndex.astro';

const posts = await getCollection('posts');

// Sort all posts by date
const allPosts = posts.sort(
  (a, b) => b.data.published.valueOf() - a.data.published.valueOf(),
);

// Tag list for sidebar/dropdown
const tagSet = new Set<string>();
for (const p of allPosts) (p.data.tags ?? []).forEach((t: string) => tagSet.add(t));
const allTags = Array.from(tagSet).sort((a, b) => a.localeCompare(b));
---

<BlogIndex 
  posts={allPosts}
  title="Blog"
  description="Thoughts, poems, and other musings during the development of the Bastion Falls D&D campaign."
  showDraftToggle={true}
  allTags={allTags}
  backLink={{ href: "/welcome/", text: "← Main Site" }}
/>
