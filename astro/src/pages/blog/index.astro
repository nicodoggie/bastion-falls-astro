---
import { getCollection } from 'astro:content';
import BlogIndex from '@/components/blog/BlogIndex.astro';

const posts = await getCollection('posts');

// Sort all posts by date
const allPosts = posts.sort(
  (a, b) => {
    if (a.data.draft == true && b.data.draft == false) {
      return 1;
    }
    if (a.data.draft == false && b.data.draft == true) {
      return -1;
    }
    if (a.data.draft === false && b.data.draft === false) {
      return a.data.published.valueOf() - b.data.published.valueOf();
    }
    return 0;
  },
);

// Tag list for sidebar/dropdown
const tagSet = new Set<string>();
for (const p of allPosts) (p.data.tags ?? []).forEach((t: string) => tagSet.add(t));
const allTags = Array.from(tagSet).sort((a, b) => a.localeCompare(b));
---

<BlogIndex 
  posts={allPosts}
  title="Blog"
  description="Thoughts, poems, and other musings during the development of the Bastion Falls D&D campaign."
  showDraftToggle={true}
  allTags={allTags}
  backLink={{ href: "/welcome/", text: "← Main Site" }}
/>
